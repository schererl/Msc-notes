# MSc Notes
Notes and remarks for my research in heuristic search for HTN planning.

---

## Master's TODO

- [ ] **Mark** the presentation as "ongoing work"
- [ ] **Enroll** in the master's last semester
- [ ] **Get** the LaTeX format for the Dissertation

---

## Summary

This document summarizes the current research tasks and experiments related to:

1. [Novelty heuristic](#novelty-heuristic)  
2. [Work on landmarks](#work-on-landmarks)  
3. [Usage of bidirectional landmarks in a state-of-the-art planner (PANDA)](#usage-of-bidirectional-landmarks-in-state-of-the-art-panda)  
4. [Organizational tasks](#organization)

---

# Novelty Heuristic

- [x] **Read** the paper [A Novelty-based Heuristic for Problem Solving](https://ojs.aaai.org/index.php/AAAI/article/view/11027).
- [x] **Implement** novelty in Pytrich using `<(h,t,f), h>`.
- [ ] **Compare** novelty with the original heuristic `h`.
- [ ] **Implement** the novelty approach in **PANDA**.

**Expectations**  
Find out if novelty can:
- Contribute to solving more problems in general, or  
- At least provide an advantage in specific domains.

### Definition (Novelty in HTN planning):

Let **F** be a set of facts and **T** a set of tasks of a given HTN plannning problem $\Pi$.  
Let $ h_1, h_2, \dots, h_m $ be heuristic functions  
and $n = (s,TN)$ be a newly generated node with state $s$ and the task network $ TN $.

We defined the set of nodes generated before $n$:
$$
N(n) = \{ n' \mid n' \text{ was generated before } n \text{ and } h_j(s') = h_j(s) \text{ for all } 1 \le j \le m \}.
$$

A novelty element of node $n$ is $w = (h, f, t)$

where:
- $ h $ is the tuple of heuristic values of $n$ ($h_1, \dots, h_m$),
- $ f $ is a fact such that $ f \in s $, and
- $ t $ is the selected task from the task network (i.e. $index(t, TN) = 0$).

Let $W_n$ be the set of novelty elements generated by node $n$.  
A node $n$ is **novel** if there exists a novelty element $w \in W_n$ 
such that for every node $n' \in N(n)$ it holds that $w \notin W_{n'}$.


### February - Novelty Experiments

Implemented different novelty methods considering different heuristic values.

- The novelty elements are $w = (h, f, t)$.

- We use Greedy Best-First Search (GBFS) with the queue ordered as $(w, h')$, where $h \subseteq h'$.  
- To validate whether novelty helps solve more tasks, we typically compare configurations denoted as $(w, h)$ versus $(h)$.
1. **lmcount:**  
   - **Heuristic:** Uses the landmark count computed from bottom-up landmarks, denoted as $h_{lm}(n)$.  
   - **Evaluation Function:** $f(n) = h_{lm}(n)$.  
   - **Remarks:** Serves as a baseline.

2. **TDG-satis:**  
   - **Heuristic:** Uses the Task Decomposition Graph (TDG) heuristic with a satisficing approach, denoted as $h_{TDG}(n)$.  
   - **Evaluation Function:** $f(n) = h_{TDG}(n)$.  
   - **Remarks:** Serves as a baseline.

3. **lmcount-tdg:**  
   - **Heuristic:** Combines the landmark count and TDG-satis, i.e., $h(n) = (h_{lm}(n), h_{TDG}(n))$, without incorporating novelty.  
   - **Evaluation Function:** $f(n) = (h_{lm}(n), h_{TDG}(n))$.  
   - **Remarks:** Serves as a baseline for combined heuristics.

4. **Novelty-lm-f-t:**  
   - **Heuristic Component ($h$):** landmark count $h_{lm}(n)$ .  
   - **Novelty Computation:** Novelty element $w(n) = (h_{lm}(n), f, t)$.
   - **Evaluation Function:** $f(n) = (w(n), h_{lm}(n))$.  
   - **Remarks:** Assesses if adding novelty improves performance over the baseline.

5. **Novelty-lm-tdg-f-t:**  
   - **Heuristic Component ($h$):** landmark count and TDG $(h_{lm}(n), h_{TDG}(n))$.  
   - **Novelty Computation:** novelty element $w(n) = (h(n), f, t)$  
   - **Evaluation Function:** $f(n) = (w(n), h_{lm}(n), h_{tdg}(n))$.  
   - **Remarks:** Assesses if adding novelty improves performance over the baseline.

6. **Novelty-tdg-f-t:**  
   - **Heuristic Component ($h$):** TDG $h_{TDG}(n)$.  
   - **Novelty Computation:** novelty element $w(n) = (h_{TDG}(n), f, t).$  
   - **Evaluation Function:** $f(n) = (w(n), h_{TDG}(n))$.  
   - **Remarks:** Assesses if adding novelty improves performance over the baseline.

7. **Novelty-bid-tdg-f-t:**  
   - **Heuristic Component ($h$):** Bidirectional landmarks with TDG-satis $(h_{bid}(n), h_{TDG}(n))$.  
   - **Novelty Computation:** novelty element $w(n) = (h_{bidTDG}(n), f, t)$  
   - **Evaluation Function:** $f(n) = (w(n), h_{bid}(n), h_{TDG}(n))$.  
   - **Remarks:** Assesses if bidirectiona lms  performance over (5).

8. **Novelty-tdg-bid-f-t:**  
   - **Heuristic Component ($h$):** Uses TDG-satis and bidirectional landmarks $(h_{TDG}(n), h_{bid}(n))$.
   - **Novelty Computation:** novelty element $w(n) = (h_{TDG}(n), h_{bid}(n), f, t)$  
   - **Evaluation Function:** $f(n) = (w(n), h_{TDG}(n), h_{bid}(n))$.  
   - **Remarks:** Compares the impact of using a different ordering of heuristics.

9. **Novelty-lmonly_bu-tdg-f-t:**  
   - **Heuristic Component ($h$):** Uses landmark count from a bottom-up approach and TDG.  
   - **Novelty Computation:** novelty element $w(n) = (h_{lm}(n), f, t).  
   - **Evaluation Function:** $f(n) = (w(n), h_{lm}(n), h_{TDG}(n))$
   - **Remarks:** Investigates if reducing the number of potential novelty tuples by using a single heuristic (landmark count) with TDG-satis as tie-breaker yields better planning outcomes.

### Results

### Key Domain Observations

Below are a few highlighted observations comparing the combined baseline **lmcount-tdg** with the novelty configuration **Novelty-lm-tdg-f-t**. 

| Domain                | Baseline (lmcount-tdg)    | Novelty-lm-tdg-f-t     | Key Observation            |
|-----------------------|-------------|--------------------|-----------------------------------|
| **Blocksworld-GTOHP** | 27; 340.25(i); 1,636(i) | 26; 337.17(i);  1,406(i) |  novelty reduces solution size and node count. Also there are 24 problems were solved by both, instead of 26.|
| **Satellite-GTOHP**   | 12; 29.20 (i); 496.20(i) | 5; 28.60 (i); 523.20 (i)| novelty bad |
| **Transport**         | 18; 25.33(i); 116.33(i) | 3; 28.00 (i); 171.67 (i)| novelty bad |
| **Depots**            | 24; 87.54(i); 6741.88(i) | 25; 87.54 (i); 1219.54 (i)| novelty good  |
| **Multiarm-Blocksworld** | 15; 99.77(i); 2014656.38 (i)| 13; 98.69 (i); 1110331.00 (i)| novelty had a lower coverage, but it had a subtantial decrease in nodes expanded|
| **Monroe-Partially**  | 5; 9.40(i); 7482.80(i) | 5; 35.32 (i); 18268.80 (i)| same coverage but more expanded nodes and larger solution  |
| **Monroe-Fully**  | 12; 21(i); 14824.83(i) | 12; 21.5 (i); 2910.33 (i)| novelty ok reduced expanded nodes  |
| **Factories-simple** | 13; 532.75(i); 47540.25(i) | 8; 543 (i); 427762.12 (i)| novelty bad |

*Note: values are <coverage, avg solution size, avg expanded nodes> (i) values means problems intersection statistics*

---

# Work on Landmarks

## Experiments on Mandatory Tasks

Isolate the set of mandatory tasks found by the bottom-up approach and see differences in performance of:
- MT
- BU
- IBU (isolated bottom-up)

## Experiments on Landmark Updates

Test if landmark updates can be effective, running an extended version in PANDA.

**Expectations**  
Landmark updates are a fast way to generate more landmarks without the need for recomputing them entirely (which is expensive), thus this approach could add information without compromising the heuristicâ€™s role.

---

## Usage of Bidirectional Landmarks in State-of-the-Art PANDA-LAMA

- [x] **Implement** bidirectional landmarks in **PANDA-lama**.
- [ ] **Run** experiments comparing bidirectional landmarks with LM-Cut and bottom-up approaches.

**Expectations**  
Determine if bidirectional landmarks enhance the performance of state-of-the-art planners.

---

# Organization

## Merge the PANDA Projects

- [ ] Merge **panda-lama** and **Dealer** into a single GitHub repository.
- [ ] Organize files and scripts in a coherent structure.
- [ ] Standardize the parser and grounder so they can work in both.

---
